---
# yaml-language-server: $schema=https://schema.blue-build.org/module-stage-list-v1.json
# (Mostly) established apps selection
modules:

  - type: script
    snippets:
      - "curl https://codeberg.org/api/packages/yataro/rpm.repo | sed -e 's/gpgcheck=1/gpgcheck=0/' > /tmp/sourcegit.repo"

  - type: dnf
    repos:
      copr:
        - ublue-os/staging
        - ublue-os/packages
        - scottames/ghostty
        - dsommers/openvpn3
      files:
        - https://download.sublimetext.com/rpm/stable/x86_64/sublime-text.repo
        - /tmp/sourcegit.repo
      keys:
        - https://download.sublimetext.com/sublimehq-rpm-pub.gpg
    install:
      packages:
        - solaar
        - sublime-text
        - sourcegit
        - ghostty 
        - seafile-client
        - openvpn3-client
        - https://bitwarden.com/download/?app=desktop&platform=linux&variant=rpm
        - https://github.com/2dust/v2rayN/releases/latest/download/v2rayN-linux-rhel-x64.rpm 
        - firefox
        - firefox-langpacks
    remove:
      packages:
        - input-remapper
        - gnome-tweaks
        # - fish # Temporary solution to solve ghostty terminfo bug; install from brew https://github.com/ghostty-org/ghostty/issues/2542
    optfix:
      - Bitwarden
      - sublime_text
      - sourcegit
      - v2rayN

  - type: script
    snippets:
      # Additional Bitwarden stuff to do
      - "ln -sf /usr/lib/opt/Bitwarden/bitwarden /etc/alternatives/bitwarden"
      # - "chcon system_u:object_r:usr_t:s0 /usr/share/polkit-1/actions/com.bitwarden.Bitwarden.policy"
      # Cleanup
      - "rm -f /tmp/sourcegit.repo"
